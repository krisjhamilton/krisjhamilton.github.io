<!doctype html5>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Destiny Settings</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>

  <div class="row">
    <div class="small-12 columns">
      <h2>Destiny Settings</h2>
    </div>
  </div>
  <section>
    <div class="row">
      <div class="small-12 columns">
        <h2>Script URL</h2>
        <input type="text" id="username" value="n6e7o8"/>
        <input type="radio" name="platform" value="2" checked>PSN
        <input type="radio" name="platform" value="1">XBOX
        
        <button id="save-button">Save</button>
        <button id="return-button">Return</button>

      </div>
    </div>
  </section>
<!--
<script>
  //Setup to allow easy adding more options later
  function saveOptions() {
    var username = document.getElementById("username");
    var pForm = document.getElementById("platform");
 
    var options = {
      "username": $('#username').value,
      "pForm": pForm.options[pForm.selectedIndex].value
    }
     
    return options;
  };
 
  $('#save-button').on('click', function() {
    console.log("Submit");

    var options = saveOptions();
    var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));
     
    document.location = location;
  });
  
</script>

-->

<script>
  var username;
  var platform;
  var url1;
  var memId;
  var url2;
  var options;


  $('#save-button').on('click', function() {
    username = $('#username').val();
    platform = $("input[type='radio'][name='platform']:checked").val();
    url1 = "http://www.bungie.net/Platform/Destiny/SearchDestinyPlayer/"+platform+"/"+username+"/";
    memId = "";
    url2;
    options = {};

    function customOutput(){
        var output;
        $.ajax({
              url: url1,
              async: false,
              //crossDomain: true
        
        success: function(data){
              output = data.Response[0].membershipId;
              $('#url').val(data.result);
            }
        });
        return output;
    }
    memId = customOutput();
    console.log(memId)

   });

  $('#return-button').on('click', function() {
    if(memId){
    console.log(memId);
    url2 = "http://www.bungie.net/Platform/Destiny/"+platform+"/Account/"+memId+"/";
    console.log(url2);
    options = {
      'username': $('#username').val(),
      'platform': $("input[type='radio'][name='platform']:checked").val(),
      'url': url2
    };
    //console.log(myCallBack())
    setTimeout(function(){ document.location = 'pebblejs://close#' + encodeURIComponent(JSON.stringify(options));}, 2000 ); 
    
    console.log(options);
  }
  });
  //var memId = JSON.parse('url1');
  //var jsonD = memId.Response[0].membershipId;
      
  //console.log(jsonD);

  

  
  


</script>



</body>
</html>